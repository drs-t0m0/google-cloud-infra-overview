# Cloud Composer 解説

**Cloud Composerとは**

Cloud Composerは、Google Cloudが提供するフルマネージドなワークフローオーケストレーションサービスです。Apache Airflowをベースとしており、クラウドとオンプレミスにまたがるワークフローの作成、スケジュール、モニタリング、管理をGUIやPythonコードを通じて行うことができます。インフラの管理をGoogleに任せ、ワークフローの構築と運用に集中できる点が大きなメリットです。

**主な機能**

* **フルマネージド:** インフラのプロビジョニングや管理が不要で、スケーリングも自動で行われます。
* **Apache Airflowベース:** 広く普及しているオープンソースのワークフロー管理ツールであるAirflowの機能と互換性があります。既存のAirflowの知識やDAG（Directed Acyclic Graph）をそのまま活用できます。
* **Pythonによるワークフロー定義:** Pythonを用いて柔軟かつ複雑なワークフローを記述できます。
* **豊富なGoogle Cloudサービスとの連携:** BigQuery、Cloud Storage、Dataflow、Pub/Subなど、様々なGoogle Cloudサービスとの連携が容易です。
* **GUIによる監視と管理:** AirflowのWeb UIを通じて、ワークフローの実行状況やログを視覚的に監視し、管理できます。
* **自動スケーリング:** ワークロードの増減に応じて、ワーカーノードが自動的にスケールアップ・ダウンします。
* **ハイブリッドおよびマルチクラウド対応:** クラウドだけでなく、オンプレミスや他のクラウド環境のデータやサービスとも連携するワークフローを構築できます。
* **セキュリティ機能:** IAMによるアクセス制御や、顧客管理の暗号鍵（CMEK）による暗号化など、セキュリティ機能が充実しています。
* **モニタリングとロギング:** Cloud MonitoringやCloud Loggingと統合されており、詳細なメトリクスやログを容易に確認できます。

**料金**

Cloud Composerの料金は、主に以下の要素に基づいて課金されます。

* **環境のサイズ:** Small、Medium、Largeなどの環境サイズによって、時間あたりの料金が異なります。
* **ワーカーノード:** 実行するタスクの量に応じて自動的にスケーリングされるワーカーノードの利用時間に応じた料金が発生します。
* **データベースのストレージ:** Airflowメタストアとして使用されるデータベースのストレージ容量に応じた月額料金が発生します。
* **コンピューティング リソース:** vCPU、メモリ、ストレージの使用量に応じた料金が発生します。
* **ネットワーク:** 環境からの送信データ転送量に応じて、VPCネットワークの料金が適用されます。

料金体系はCloud Composerのバージョンによって異なる場合があります。詳細は[Cloud Composer の料金](https://cloud.google.com/composer/pricing?hl=ja)をご確認ください。

**類似サービスとの比較**

Google Cloudには、Cloud Composer以外にもワークフローやデータ処理に関連するサービスがあります。

* **Cloud Workflows:** サーバーレスでフルマネージドなワークフローエンジンです。HTTPベースのAPI呼び出しをオーケストレーションするのに適しており、Cloud FunctionsやCloud Runなどのサーバーレスサービスとの連携が容易です。Cloud Composerと比較して、より軽量でイベントドリブンなワークフローに向いています。
* **Cloud Dataflow:** Apache Beamをベースとした、スケーラブルなデータ処理サービスです。バッチ処理とストリーム処理の両方に対応しており、大規模なデータ変換や分析パイプラインの構築に適しています。Cloud Composerはワークフロー全体を管理するのに対し、Cloud Dataflowはデータ処理タスクに特化しています。
* **BigQueryのスケジュールされたクエリ:** BigQuery内でSQLクエリの実行をスケジュールできる機能です。BigQuery内のデータ処理や分析タスクの自動化に適しています。Cloud Composerはより複雑なワークフローや、複数のサービスを連携させる場合に適しています。
* **Cloud Functions/Cloud Run:** イベントドリブンなサーバーレスコンピューティングサービスです。特定のイベントに応じてコードを実行するのに適しており、簡単なタスクの自動化に利用できます。Cloud Composerは、複数のステップからなる複雑なワークフローの管理に適しています。

**利用シナリオ**

Cloud Composerは、以下のような様々なシナリオで活用できます。

* **ETL/ELTパイプラインの構築:** 複数のデータソースからデータを抽出、変換、ロードしてデータウェアハウス（BigQueryなど）に格納する処理を自動化します。
* **機械学習パイプラインのオーケストレーション:** データの前処理、モデルのトレーニング、評価、デプロイといった一連の機械学習ワークフローを自動化します。
* **バッチ処理の自動化:** 定期的なデータ処理、レポート生成、バックアップなどのバッチ処理をスケジュールに基づいて実行します。
* **アプリケーション連携:** 複数のアプリケーションやサービス間のデータ連携や処理フローを自動化します。
* **ハイブリッドクラウド環境でのデータ統合:** オンプレミスとクラウド上のシステム間でデータを同期したり、連携した処理を実行したりします。
* **IoTデータの処理パイプライン:** IoTデバイスから収集されたデータをリアルタイムまたはバッチで処理し、分析や可視化に利用します。

ご希望に応じて、特定の機能や利用シナリオについてさらに詳しくご説明することも可能です。

## 参考

- https://cloud.google.com/composer/docs/composer-3/composer-overview?hl=ja
- https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/composer_environment
